filter(stock %in% unique(cluster_dat$stock))
# Plot histogram of updated
ggplot(ODI_dat,
aes(x = ODI))+
geom_histogram()+
theme_classic()
# compute age composition by stocks
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
group_by(run_origin, brood_year)%>%
summarize(n = n()),
aes(x = brood_year, y = n, group = run_origin))+
geom_point()+
geom_line()+
geom_smooth(method = "lm")+
facet_wrap(~run_origin, scales = "free_y")
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_year.png")
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1),
aes(x = age))+
geom_histogram()+
facet_wrap(~run_origin, scales = "free")+
theme_classic()
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_age.png")
# remove stocks with fewer than 100 observations for ODI
dat1 <- dat1 %>%
group_by(release_location_rmis_basin,release_type,run) %>%
mutate(n_obs = sum(ocean_age > 1))%>%
filter(n_obs > 100)
## method used before 8/5/22 to group stock and calcaulte the ocena distirubton index
distribution_summary_old <- dat1 %>%
dplyr::group_by(stock) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
p52.5 = sum(latitude <= 52.5)/n(),
COG = mean(latitude),
COG_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n = n(),
run = Mode(run),
sex = Mode(sex),
release_type = Mode(release_type),
release_location_rmis_region = Mode(release_location_rmis_region),
release_location_rmis_basin = Mode(release_location_rmis_basin))%>%
dplyr::filter(n > 10)
## new method used to calcualte ocean distributon index
## calcualting ocean distribuiton by RMIS basin, run and release type.
## not diferntiating by sex
ODI <- dat1 %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(ODI = sum(latitude),
ODI_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n_ODI = n())
# group stock characteristics differntiating by sex
dat_stocks <- dat1 %>%
dplyr::group_by(stock,release_location_rmis_basin,release_type,run) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
sex = Mode(sex),
release_location_rmis_region = Mode(release_location_rmis_region))%>%
dplyr::filter(n > 10)
## merge ocean distribution index and other stock characteristics
distribution_summary <- merge(dat_stocks ,ODI,
by = c("release_location_rmis_basin",
"release_type",
"run"))
ggplot(
data.frame(Index = distribution_summary$ODI,
Index_no_imp = distribution_summary$ODI_check),
aes(x = Index, y = Index_no_imp))+
geom_point()+
geom_smooth(method = "lm")+
ggtitle(paste("Correlation",
cor(distribution_summary$ODI,
distribution_summary$ODI_check)))+
theme_classic()
ggsave("figures/ODI_imputation.png",
height = 5,
width = 5)
write.csv(distribution_summary , "transformed_data/stock_characteristics_data.csv")
write.csv(dat1 , "transformed_data/marine_observations.csv")
# remove stocks with fewer than 100 observations for ODI
dat1 <- dat1 %>%
group_by(release_location_rmis_basin,release_type,run) %>%
mutate(n_obs = n())%>%
filter(n_obs > 100)
## method used before 8/5/22 to group stock and calcaulte the ocena distirubton index
distribution_summary_old <- dat1 %>%
dplyr::group_by(stock) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
p52.5 = sum(latitude <= 52.5)/n(),
COG = mean(latitude),
COG_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n = n(),
run = Mode(run),
sex = Mode(sex),
release_type = Mode(release_type),
release_location_rmis_region = Mode(release_location_rmis_region),
release_location_rmis_basin = Mode(release_location_rmis_basin))%>%
dplyr::filter(n > 10)
## new method used to calcualte ocean distributon index
## calcualting ocean distribuiton by RMIS basin, run and release type.
## not diferntiating by sex
ODI <- dat1 %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(ODI = sum(latitude),
ODI_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n_ODI = n())
# group stock characteristics differntiating by sex
dat_stocks <- dat1 %>%
dplyr::group_by(stock,release_location_rmis_basin,release_type,run) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
sex = Mode(sex),
release_location_rmis_region = Mode(release_location_rmis_region))%>%
dplyr::filter(n > 10)
## merge ocean distribution index and other stock characteristics
distribution_summary <- merge(dat_stocks ,ODI,
by = c("release_location_rmis_basin",
"release_type",
"run"))
ggplot(
data.frame(Index = distribution_summary$ODI,
Index_no_imp = distribution_summary$ODI_check),
aes(x = Index, y = Index_no_imp))+
geom_point()+
geom_smooth(method = "lm")+
ggtitle(paste("Correlation",
cor(distribution_summary$ODI,
distribution_summary$ODI_check)))+
theme_classic()
ggsave("figures/ODI_imputation.png",
height = 5,
width = 5)
write.csv(distribution_summary , "transformed_data/stock_characteristics_data.csv")
write.csv(dat1 , "transformed_data/marine_observations.csv")
ODI <- dat1 %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(ODI = mean(latitude),
ODI_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n_ODI = n())
# group stock characteristics differntiating by sex
dat_stocks <- dat1 %>%
dplyr::group_by(stock,release_location_rmis_basin,release_type,run) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
sex = Mode(sex),
release_location_rmis_region = Mode(release_location_rmis_region))%>%
dplyr::filter(n > 10)
## merge ocean distribution index and other stock characteristics
distribution_summary <- merge(dat_stocks ,ODI,
by = c("release_location_rmis_basin",
"release_type",
"run"))
ggplot(
data.frame(Index = distribution_summary$ODI,
Index_no_imp = distribution_summary$ODI_check),
aes(x = Index, y = Index_no_imp))+
geom_point()+
geom_smooth(method = "lm")+
ggtitle(paste("Correlation",
cor(distribution_summary$ODI,
distribution_summary$ODI_check)))+
theme_classic()
ggsave("figures/ODI_imputation.png",
height = 5,
width = 5)
write.csv(distribution_summary , "transformed_data/stock_characteristics_data.csv")
write.csv(dat1 , "transformed_data/marine_observations.csv")
# remove stocks with fewer than 100 observations for ODI
dat1 <- dat1 %>%
group_by(release_location_rmis_basin,release_type,run) %>%
mutate(n_obs = sum(ocean_age > 1))%>%
filter(n_obs > 100)
## method used before 8/5/22 to group stock and calcaulte the ocena distirubton index
distribution_summary_old <- dat1 %>%
dplyr::group_by(stock) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
p52.5 = sum(latitude <= 52.5)/n(),
COG = mean(latitude),
COG_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n = n(),
run = Mode(run),
sex = Mode(sex),
release_type = Mode(release_type),
release_location_rmis_region = Mode(release_location_rmis_region),
release_location_rmis_basin = Mode(release_location_rmis_basin))%>%
dplyr::filter(n > 10)
## new method used to calcualte ocean distributon index
## calcualting ocean distribuiton by RMIS basin, run and release type.
## not diferntiating by sex
ODI <- dat1 %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(ODI = mean(latitude),
ODI_check = sum(latitude*(1-imputed_val))/sum((1-imputed_val)),
n_ODI = n())
# group stock characteristics differntiating by sex
dat_stocks <- dat1 %>%
dplyr::group_by(stock,release_location_rmis_basin,release_type,run) %>%
dplyr::filter(!(is.na(latitude)), sex %in% c("M","F")) %>%
dplyr::summarize(
sex = Mode(sex),
release_location_rmis_region = Mode(release_location_rmis_region))%>%
dplyr::filter(n > 10)
## merge ocean distribution index and other stock characteristics
distribution_summary <- merge(dat_stocks ,ODI,
by = c("release_location_rmis_basin",
"release_type",
"run"))
ggplot(
data.frame(Index = distribution_summary$ODI,
Index_no_imp = distribution_summary$ODI_check),
aes(x = Index, y = Index_no_imp))+
geom_point()+
geom_smooth(method = "lm")+
ggtitle(paste("Correlation",
cor(distribution_summary$ODI,
distribution_summary$ODI_check)))+
theme_classic()
ggsave("figures/ODI_imputation.png",
height = 5,
width = 5)
write.csv(distribution_summary , "transformed_data/stock_characteristics_data.csv")
write.csv(dat1 , "transformed_data/marine_observations.csv")
library(dplyr)
library(ggplot2)
library(rstan)
library(reshape2)
setwd("~/Chinook_growth_repo")
## load the relevant dat sets
ODI_dat <- read.csv("~/Chinook_growth_repo/transformed_data/stock_characteristics_data.csv")
marine_dsn_dat <- read.csv("~/Chinook_growth_repo/transformed_data/marine_observations.csv")
## load cluster analysis data for stocks to look at
cluster_dat <- read.csv("~/Chinook_growth_repo/transformed_data/cluster_analysis_data.csv")
### Check the effects of keeping observations with missing vlaeus for sex
### added 8/5/22
# computre val old way removing missing values of sex
ODI_filter <- marine_dsn_dat %>%
dplyr::filter(sex %in% c("M","F"),!(is.na(latitude))) %>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(COG_filter = mean(latitude),
n_filter = n())
# compute value new way using these values
ODI_ <- marine_dsn_dat %>%
dplyr::filter(!(is.na(latitude))) %>%
dplyr::group_by(release_location_rmis_basin,release_type,run) %>%
dplyr::summarize(COG = mean(latitude),
n = n())
compare_dat <- merge(ODI_,ODI_filter,
by = c("release_location_rmis_basin",
"release_type",
"run"))
ggplot(compare_dat,
aes(x=as.numeric(COG_filter),y=as.numeric(COG)))+
geom_point()+
geom_smooth(method="lm")
#### Check data for robustness to biases in ocean distirubtion
#### caused by variation in distirubtion by age
# filter for stock used in cluster analysis
# create variable for stock not including sex
cluster_dat <- cluster_dat %>%
mutate(run_origin = paste(release_location_rmis_basin,run,release_type))
marine_dsn_dat <- marine_dsn_dat%>%
mutate(run_origin = paste(release_location_rmis_basin,run,release_type))
marine_dsn_dat_clusters <-  marine_dsn_dat %>%
filter(run_origin %in% unique(cluster_dat$run_origin))
ODI_dat <- ODI_dat %>%
filter(stock %in% unique(cluster_dat$stock))
# Plot histogram of updated
ggplot(ODI_dat,
aes(x = ODI))+
geom_histogram()+
theme_classic()
# compute age composition by stocks
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
group_by(run_origin, brood_year)%>%
summarize(n = n()),
aes(x = brood_year, y = n, group = run_origin))+
geom_point()+
geom_line()+
geom_smooth(method = "lm")+
facet_wrap(~run_origin, scales = "free_y")
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_year.png")
# plot
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1),
aes(x = ocean_age))+
geom_histogram()+
facet_wrap(~run_origin, scales = "free")+
theme_classic()
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_age.png")
## comapre pre brood year 1990 ODI to post BY 1990
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
mutate(range = (recovery_year < 1994) & (recovery_year > 1979))%>%
group_by(run_origin, range) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ range ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base index")+
ylab("1979 - 1994")
ggsave("~/Chinook_growth_repo/figures/full_ODI_and_1974_1994.png")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, age == 4) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ `age != 4` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("Age 4 only")
ggsave("~/Chinook_growth_repo/figures/full_ODI_and_age_4_only.png")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("Age 4 only")
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 2) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ `ocean_age == 2` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("Age 4 only")
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1),
aes(x = ocean_age))+
geom_histogram()+
facet_wrap(~run_origin, scales = "free")+
theme_classic()
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1),
aes(x = ocean_age))+
geom_histogram()+
facet_wrap(~run_origin, scales = "free_y")+
theme_classic()
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean qge 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`, color = n()))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`, color = n)+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`, color = n))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`, color = n))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(run_origin ~ `ocean_age == 3`+ n  ),
aes(x = `FALSE`, y = `TRUE`, color = n))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude), n = n()) %>%
reshape2::dcast(n+run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`, color = n))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
# compare currnet ODI metric to just age 4
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(n+run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_year.png",
height = 10,
width = 10)
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1)%>%
group_by(run_origin, brood_year)%>%
summarize(n = n()),
aes(x = brood_year, y = n, group = run_origin))+
geom_point()+
geom_line()+
geom_smooth(method = "lm")+
facet_wrap(~run_origin, scales = "free_y")+
theme_classic()
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_year.png",
height = 10,
width = 10)
d_corr <- marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
mutate(range = (recovery_year < 1994) & (recovery_year > 1979))%>%
group_by(run_origin, range) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(run_origin ~ range )
cor(d_corr$`TRUE`, d_corr$`FALSE`)
cor(ODI_estimate_number$ODI,ODI_estimate_number$ODI_EN)
marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(n+run_origin ~ `ocean_age == 3` )
cor(d_corr$`TRUE`, d_corr$`FALSE`)
d_corr_age <- marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(n+run_origin ~ `ocean_age == 3` )
cor(d_corr_age$`TRUE`, d_corr_age$`FALSE`)
ggplot(marine_dsn_dat_clusters %>%
dplyr::filter(!(is.na(latitude)), ocean_age > 1) %>%
group_by(run_origin, ocean_age == 3) %>%
summarize(ODI = mean(latitude)) %>%
reshape2::dcast(n+run_origin ~ `ocean_age == 3` ),
aes(x = `FALSE`, y = `TRUE`))+
geom_point()+
geom_smooth(method = "lm")+
theme_classic()+
xlab("base Index")+
ylab("ocean age 3 only")
ggsave("~/Chinook_growth_repo/figures/full_ODI_and_age_4_only.png")
# plot
ggplot(marine_dsn_dat_clusters %>%
filter(!(is.na(latitude)), ocean_age > 1),
aes(x = ocean_age))+
geom_histogram()+
facet_wrap(~run_origin, scales = "free_y")+
theme_classic()
ggsave("~/Chinook_growth_repo/figures/ODI_samples_by_age.png",
height = 10,
width = 10)
