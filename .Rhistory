library(ggplot2)
library(dplyr)
library(reshape2)
setwd("~/Chinook_growth_repo")
dat <- read.csv("transformed_data/covariates.csv")
dat_melt <- dat %>% reshape2::melt(id.var = "year")
dat_melt$variable <- order(dat_melt$variable,
c("MEI", "SSTarc", "PDO","ALPI","NPGO","BI", "WA_Pinks", "Pinks"))
dat_melt <- dat %>% reshape2::melt(id.var = "year")
dat_melt$variable <- factor(dat_melt$variable,
levels=c("MEI", "SSTarc", "PDO","ALPI",
"NPGO","BI", "WA_Pinks", "Pinks"))
ggplot(dat_melt, aes(x = year, y = value))+
geom_point()+
geom_path()+
facet_wrap(~variable, ncol= 2)+
theme_classic()+
theme(axis.text = element_text(family = "Times New Roman",size = 16),
axis.title = element_text(family = "Times New Roman",size = 28),
legend.text = element_text(family = "Times New Roman",size = 20),
legend.title = element_text(family = "Times New Roman",size = 25),
strip.text = element_text(family = "Times New Roman",size = 25))
names(dat_melt$variable)
unique(dat_melt$variable)
dat_melt <- dat %>% reshape2::melt(id.var = "year")
unique(dat_melt$variable)
dat <- dat %>% dplyr::select(year,Pinks, WA_Pinks, BI,
NPGO, ALPI, MEI_summer,PDO,
SSTarc_summer)%>%
dplyr::mutate(SSTarc = SSTarc_summer,MEI = MEI_summer)%>%
dplyr::select(-MEI_summer,-SSTarc_summer)
dat_melt <- dat %>% reshape2::melt(id.var = "year")
dat_melt$variable <- factor(dat_melt$variable,
levels=c("MEI", "SSTarc", "PDO","ALPI",
"NPGO","BI", "WA_Pinks", "Pinks"))
ggplot(dat_melt, aes(x = year, y = value))+
geom_point()+
geom_path()+
facet_wrap(~variable, ncol= 2)+
theme_classic()+
theme(axis.text = element_text(family = "Times New Roman",size = 16),
axis.title = element_text(family = "Times New Roman",size = 28),
legend.text = element_text(family = "Times New Roman",size = 20),
legend.title = element_text(family = "Times New Roman",size = 25),
strip.text = element_text(family = "Times New Roman",size = 25))
dat_melt$variable <- factor(dat_melt$variable,
levels=c("MEI", "NPGO", "SSTarc", "BI",
"PDO","WA_Pinks","ALPI", "Pinks"))
ggplot(dat_melt, aes(x = year, y = value))+
geom_point()+
geom_path()+
facet_wrap(~variable, ncol= 2)+
theme_classic()+
theme(axis.text = element_text(family = "Times New Roman",size = 16),
axis.title = element_text(family = "Times New Roman",size = 28),
legend.text = element_text(family = "Times New Roman",size = 20),
legend.title = element_text(family = "Times New Roman",size = 25),
strip.text = element_text(family = "Times New Roman",size = 25))
ggsave("figures/covars_series.png",
height = 7,
width = 8.5)
# seed 2
stock_characteristics <- read.csv("~/Chinook_growth_repo/transformed_data/stock_characteristics_data.csv")
data_clusters_k2 <- read.csv("~/Chinook_growth_repo/model_output/clusters/data_n2_age4_seed2.csv")
p <- ggplot(d_merged_k2  %>%
group_by(stock_char)%>%
summarize(release_age = mean(release_age.x)+1,
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(release_age)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, release_age)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(release_age), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(release_age), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = pnw_palette("Cascades", n=2), name = "Cluster")+
ylab("Proporiton")+
xlab("Release age")+
theme_test()+
theme(axis.title = element_text(size = 28, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 22, family = "Times New Roman"),
legend.position = "bottom")
# ocean distribution
stock_characteristics$stock_char <- stock_characteristics$stock
d_merged_k2 <- merge(data_clusters_k2 ,stock_characteristics, by = "stock_char")
p <- ggplot(d_merged_k2  %>%
group_by(stock_char)%>%
summarize(release_age = mean(release_age.x)+1,
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(release_age)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, release_age)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(release_age), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(release_age), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = pnw_palette("Cascades", n=2), name = "Cluster")+
ylab("Proporiton")+
xlab("Release age")+
theme_test()+
theme(axis.title = element_text(size = 28, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 22, family = "Times New Roman"),
legend.position = "bottom")
library(ggplot2)
library(dplyr)
library(mgcv)
library(PNWColors)
p <- ggplot(d_merged_k2  %>%
group_by(stock_char)%>%
summarize(release_age = mean(release_age.x)+1,
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(release_age)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, release_age)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(release_age), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(release_age), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = pnw_palette("Cascades", n=2), name = "Cluster")+
ylab("Proporiton")+
xlab("Release age")+
theme_test()+
theme(axis.title = element_text(size = 28, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 22, family = "Times New Roman"),
legend.position = "bottom")
p
ggsave(file = "figures/Clusters_release_age_n2_seed2.png",
p,
width = 7,
height = 6)
# using seed 2
stock_characteristics <- read.csv("~/Chinook_growth_repo/transformed_data/stock_characteristics_data.csv")
data_clusters_k3 <- read.csv("~/Chinook_growth_repo/model_output/clusters/data_n3_age4_seed2.csv")
# ocean distribution
stock_characteristics$stock_char <- stock_characteristics$stock
d_merged_k3 <- merge(data_clusters_k3,stock_characteristics, by = "stock_char")
p <- ggplot(d_merged_k3  %>%
group_by(stock_char)%>%
summarize(run = mean(run.x),
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(run)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, run)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(run), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(run), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = pnw_palette("Cascades", n=3), name = "Cluster")+
scale_x_discrete(label = c("Spring", "Summer", "Fall", "Late Fall"))+
ylab("Proporiton")+
xlab("Run timing")+
theme_test()+
theme(axis.title = element_text(size = 32, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 24, family = "Times New Roman"),
legend.position = "bottom")
p
ggsave(file = "figures/Clusters_run_type_n3_seed2.png",
p,
width = 6,
height = 5)
p <- ggplot(d_merged_k3  %>%
group_by(stock_char)%>%
summarize(release_age = mean(release_age1),
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(release_age)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, release_age)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(release_age), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(release_age), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = PNWColors::pnw_palette("Cascades", n=3), name = "Cluster")+
#scale_x_discrete(label = c("Spring", "Summer", "Fall", "Late Fall"))+
ylab("Proporiton")+
xlab("Release age")+
theme_test()+
theme(axis.title = element_text(size =32, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 24, family = "Times New Roman"),
legend.position = "bottom")
d_merged_k3$release_age1 <- plyr::mapvalues(d_merged_k3$release_age.x, c(1,2), c(1,2))
p <- ggplot(d_merged_k3  %>%
group_by(stock_char)%>%
summarize(release_age = mean(release_age1),
cluster = mean(cluster))%>%
ungroup()%>%
dplyr::group_by(release_age)%>%
dplyr::mutate(m = n())%>%
dplyr::ungroup()%>%
dplyr::group_by(cluster, release_age)%>%
dplyr::summarise(p = n()/mean(m),
m = mean(m)),
aes(x = as.factor(release_age), y = p, fill = as.factor(cluster)))+
geom_bar(stat = "identity")+
geom_text(aes(x = as.factor(release_age), y = 1.025, label = paste("n =", m)))+
scale_fill_manual(values = PNWColors::pnw_palette("Cascades", n=3), name = "Cluster")+
#scale_x_discrete(label = c("Spring", "Summer", "Fall", "Late Fall"))+
ylab("Proporiton")+
xlab("Release age")+
theme_test()+
theme(axis.title = element_text(size =32, family = "Times New Roman"),
axis.text = element_text(size = 24, family = "Times New Roman"),
legend.text = element_text(size = 24, family = "Times New Roman"),
legend.title = element_text(size = 24, family = "Times New Roman"),
legend.position = "bottom")
p
ggsave(file = "~/Chinook_growth_repo/figures/Clusters_release_age_n3_seed2.png",
p,
width = 6,
height = 5)
install.packages("caret")
